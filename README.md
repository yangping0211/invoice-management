# 請求管理システム サンプルアプリケーション

## 概要

このリポジトリは、**業務システム開発ガイドラインのサンプルアプリケーション**として開発された「請求管理システム」です。現代のWebアプリケーション開発で広く利用される技術スタックを組み合わせ、堅牢性、保守性、拡張性を考慮した業務システム開発のベストプラクティスを示すことを目的としています。

本アプリケーションは、シンプルな請求情報の登録・管理機能を提供します。単なるCRUDアプリケーションに留まらず、セキュリティ、データ永続化、フロントエンド、バリデーション、レポート生成など、業務システムに求められる多岐にわたる要素を網羅しており、実際のプロジェクトのひな形として活用いただけます。

---

## 技術スタック

本アプリケーションは以下の主要な技術で構成されています。

### バックエンド

- **Spring Boot**: JavaベースのWebアプリケーションフレームワーク。迅速な開発と実行環境の提供。
- **Spring Security**: 認証・認可機能を提供するセキュリティフレームワーク。
- データアクセス層は、ドメイン駆動設計に適した柔軟な構成を採用しており、O/Rマッパーの JPA と、SQLマッパーの Doma のいずれにも対応できる設計となっています。初期実装は JPA ですが、Doma に差し替え可能な構成（リポジトリの抽象化・モジュール分離）をガイドラインに基づいて実装する予定です
- **Flyway**: データベースのスキーママイグレーションツール。バージョン管理されたスクリプトでデータベース変更を管理。
- **Bean Validation**: データ入力のバリデーションを簡潔に実装。
- **Yavi**: より柔軟で強力なバリデーションルール定義のためのライブラリ。
- **JasperReports**: 帳票生成ライブラリ。請求書などのレポート出力に利用。

### フロントエンド

- **Thymeleaf**: サーバーサイドレンダリング（SSR）を行うためのテンプレートエンジン。
- **Tailwind CSS**: ユーティリティファーストのCSSフレームワーク。高速なUI開発を実現。
- **htmx**: HTMLを拡張し、JavaScriptなしでAjaxリクエストやDOM操作を可能にするライブラリ。
- **Alpine.js**: 軽量なJavaScriptフレームワーク。簡単なインタラクティブ性をHTMLに直接追加。

### 開発・テスト

- **testcontainers**: テスト環境でDockerコンテナをプログラムから起動し、データベースなどの依存サービスを分離してテスト。
- **DevContainer (開発コンテナ)**: 開発環境をDockerコンテナとして定義。開発者ごとの環境差異をなくし、オンボーディングを迅速化。

---

## 実装予定機能

このアプリケーションは、請求管理に関する基本的な業務フローを中心に、業務システム開発に求められる多様な要素を実装対象としています。単なる CRUD に留まらず、バリデーション、状態管理、帳票出力、認証・認可、テストなどを含み、実際の業務アプリケーション開発におけるベストプラクティスの実例となることを目的としています。

### 顧客管理機能

- 顧客情報の登録・編集・削除・検索
- 顧客に紐づく請求書の一覧表示

### 請求書管理機能

- 請求書の作成・編集・削除・参照
- 請求書に明細を追加（商品名、単価、数量、金額など）
- 小計・消費税・合計金額の自動算出
- 請求書の状態管理（例：下書き → 発行済 → 入金済）

### 帳票出力機能

- 請求書の PDF 出力（帳票テンプレートを使用したレイアウト）
- ロゴや宛先、請求日などを含むビジネス帳票の作成

### 検索・一覧機能

- 請求書一覧の表示（ページング・並び替え対応）
- 顧客名、請求日、状態などによるフィルタリング検索

### ユーザー認証・認可

- ログイン／ログアウト機能（Spring Security による認証）
- 権限に応じた画面や操作の制御（例：管理者のみ編集可能）

### バリデーション

- ドメインルールに基づく入力検証（Bean Validation または Yavi）
- エラーメッセージの国際化対応（必要に応じて）

### テスト

- 単体テスト（ドメイン、アプリケーションサービス、コントローラ）
- 結合テスト（Testcontainers による DB 連携テスト）
- バリデーション・状態遷移のテスト

## 拡張予定またはオプション機能

以下の機能は、開発ガイドラインの応用例や拡張設計のサンプルとして、必要に応じて実装される予定です。

- 入金状況の管理とステータス更新
- メール送信機能（請求書送付など）
- 請求番号の採番ルール（連番または UUID）
- 月次集計や発行日ベースの売上分析
- 操作履歴の記録・表示（監査対応）

---

## 開発環境の準備

本アプリケーションはDevContainerに対応しているため、Visual Studio Codeなどの対応IDEを使用することで、簡単に開発環境を構築できます。

1.  **前提条件**:
    - Docker Desktop (またはDocker Engine) がインストールされていること
    - Visual Studio Code (推奨)
    - Visual Studio Code の Remote - Containers 拡張機能がインストールされていること

2.  **DevContainerでの起動**:
    1.  本リポジトリをクローンします。
    2.  VS Codeでクローンしたフォルダを開きます。
    3.  VS CodeがDevContainerの起動を促すメッセージを表示します。「Reopen in Container」を選択してください。
    4.  コンテナのビルドと起動が完了すると、必要なツールや依存関係がすべて揃った開発環境が利用可能になります。

---

## アプリケーションの実行

DevContainer内で以下のコマンドを実行することで、アプリケーションを起動できます。

1.  **ビルド**:
    ```bash
    ./mvnw clean install
    ```
2.  **実行**:
    ```bash
    ./mvnw spring-boot:run
    ```
3.  アプリケーションは通常、`http://localhost:8080` でアクセス可能です。

---

## テストの実行

DevContainer内で以下のコマンドを実行することで、テストを実行できます。

```bash
./mvnw test
```
